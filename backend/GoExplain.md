# Goパッケージ構成の説明

## 構成

このディレクトリには、クリーンアーキテクチャの原則に従った以下の主要なパッケージが含まれています：

1. **app**: アプリケーションのセットアップと依存性注入を行うパッケージ。
2. **config**: データベース接続やテストデータの設定を行うパッケージ。
3. **env**: 環境変数を管理するパッケージ。
4. **gen**: SQLクエリの自動生成コードが含まれるパッケージ。
5. **handler**: HTTPリクエストを処理するハンドラが含まれるパッケージ。
6. **repository**: データベース操作を行うリポジトリが含まれるパッケージ。
7. **usecase**: ビジネスロジックを実装するユースケースが含まれるパッケージ。
8. **util**: 汎用的なユーティリティ関数が含まれるパッケージ。

## 各パッケージの詳細

### appパッケージ

- **概要**: アプリケーションのセットアップと依存性注入を行います。
- **主なファイル**:
  - `handler.go`: ハンドラのセットアップを行います。
  - `dependency_injection.go`: 依存性注入の設定を行います。

### configパッケージ

- **概要**: データベース接続やテストデータの設定を行います。
- **主なファイル**:
  - `database.go`: 本番環境用のデータベース接続設定を行います。
  - `test_database.go`: テスト環境用のデータベース接続設定を行います。
  - `test_data.go`: テストデータの挿入と削除を行います。

### envパッケージ

- **概要**: 環境変数を管理します。
- **主なファイル**:
  - `env.go`: 環境変数を取得する関数を提供します。

### genパッケージ

- **概要**: SQLクエリの自動生成コードが含まれます。
- **主なファイル**:
  - `models.go`: データベースのモデル定義が含まれます。
  - `query.sql_gen.go`: SQLクエリの自動生成コードが含まれます。

### handlerパッケージ

- **概要**: HTTPリクエストを処理するハンドラが含まれます。
- **主なファイル**:
  - `base.go`: ハンドラのベースクラスを定義します。
  - `authorization.go`: 認証関連のハンドラを定義します。
  - `domain.go`: ドメイン固有のハンドラを定義します。

### repositoryパッケージ

- **概要**: データベース操作を行うリポジトリが含まれます。
- **主なファイル**:
  - `entity.go`: エンティティデータの操作を行います。
  - `aggregate.go`: 集約データの操作を行います。
  - `value_object.go`: 不変性を持つ値オブジェクトの永続化と取得を行います。値オブジェクトは識別子を持たず、属性の値のみで等価性が判断されます。

### usecaseパッケージ

- **概要**: ビジネスロジックを実装するユースケースが含まれます。
- **主なファイル**:
  - `domain.go`: ドメイン固有のビジネスロジックを実装します。
  - `authorization.go`: 認証関連のビジネスロジックを実装します。
- **補足**: ユースケースの関数の境界がトランザクションの境界と同じになります。

### utilパッケージ

- **概要**: 汎用的なユーティリティ関数が含まれます。
- **主なファイル**:
  - `json.go`: JSON操作に関するユーティリティ関数を提供します。
  - `string.go`: 文字列操作に関するユーティリティ関数を提供します。
  - `jwt.go`: JWT操作に関するユーティリティ関数を提供します。

## テストコード規約

### テストファイルの命名規則

- テストファイルは対象のソースファイル名に`_test.go`を付加します。
  - 例：`user.go` → `user_test.go`

### テストパッケージの命名規則

- テストパッケージは対象のパッケージ名に`_test`を付加します。
  - 例：`package repository` → `package repository_test`

### テスト関数の命名規則

- テスト関数は`Test`で始まり、テスト対象の機能を説明する名前を付けます。
  - 例：`TestGetUserByID`, `TestCreateTeam`

### テストケースの構造

1. **テストの前処理と後処理**
   ```go
   config.BeforeEachForUnitTest()      // テスト前処理
   defer config.AfterEachForUnitTest() // テスト後処理
   ```

2. **テストケースのグループ化**
   - `t.Run()`を使用してテストケースをグループ化します。
   - テストケース名は「正常系」または「異常系」で始め、続いてテストの内容を説明します。
     ```go
     t.Run("正常系01 ID:1", func(t *testing.T) {
         // テストコード
     })
     ```

3. **依存性の注入**
   - テスト用のDIコンテナを設定します。
   ```go
   injector := do.New()
   do.Provide(injector, config.TestDbConnection)
   ```

### アサーション

- `github.com/stretchr/testify/assert`パッケージを使用してアサーションを行います。
- アサーションメッセージは具体的で説明的な内容にします。
  ```go
  assert.Equal(t, expected, actual, "具体的な説明メッセージ")
  ```

### テストデータの管理

- テストデータは`config/test_data.go`で一元管理します。
- テストデータの挿入と削除は`BeforeEachForUnitTest`と`AfterEachForUnitTest`で行います。

### テストの分類

1. **ユニットテスト**
   - 個々の関数やメソッドのテスト
   - 依存関係はモック化する

2. **インテグレーションテスト**
   - 複数のコンポーネント間の連携テスト
   - 実際のデータベースを使用する場合がある

### テストの品質基準

1. **テストの独立性**
   - 各テストケースは独立して実行できるようにする
   - テスト間でデータを共有しない

2. **テストの可読性**
   - テストケース名は具体的で理解しやすいものにする
   - アサーションメッセージは説明的な内容にする
